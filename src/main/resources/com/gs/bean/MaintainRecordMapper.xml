<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gs.dao.MaintainRecordDAO">
    <resultMap id="maintainRecordResultMap" type="maintainRecord">
        <id column="recordId" property="recordId"/>
        <result column="startTime" property="startTime"/>
        <result column="endTime" property="endTime"/>
        <result column="actualEndTime" property="actualEndTime"/>
        <result column="recordCreatedTime" property="recordCreatedTime"/>
        <result column="pickupTime" property="pickupTime"/>
        <result column="trackStatus" property="trackStatus"/>
        <result column="recordDes" property="recordDes"/>
        <result column="recordStatus" property="recordStatus"/>
        <!--接待表Id-->
        <association property="checkin" javaType="com.gs.bean.Checkin">
            <id column="checkinId" property="checkinId"/>
            <result column="userName" property="userName"/>
            <result column="carPlate" property="carPlate"/>
            <result column="maintainOrFix" property="maintainOrFix"/>
        </association>
        <association property="company" javaType="com.gs.bean.Company">
            <id property="companyId" column="companyId"/>
            <id property="companyName" column="companyName"/>
        </association>
    </resultMap>
    <insert id="insert" parameterType="maintainRecord">
		<![CDATA[
          insert into t_maintain_record(recordId, checkinId, startTime, endTime, actualEndTime, recordCreatedTime, pickupTime, companyId, recordDes, recordStatus, trackStatus)
            values(#{recordId}, #{checkinId}, #{startTime}, #{endTime}, #{actualEndTime}, now(), #{pickupTime}, #{companyId}, #{recordDes}, 'Y', 'N')
        ]]>
	</insert>

    <insert id="batchInsert" parameterType="list">
		<![CDATA[

        ]]>
	</insert>

    <delete id="delete" parameterType="maintainRecord">
		<![CDATA[

        ]]>
	</delete>

    <delete id="deleteById" parameterType="string">
		<![CDATA[

        ]]>
	</delete>

    <delete id="batchDelete" parameterType="list">
		<![CDATA[

        ]]>
	</delete>

    <update id="update" parameterType="maintainRecord">
		<![CDATA[
          update t_maintain_record
            set checkinId = #{checkinId}, startTime = #{startTime}, endTime = #{endTime}, actualEndTime = #{actualEndTime}, recordCreatedTime = now(), pickupTime = #{pickupTime}, recordDes = #{recordDes}, recordStatus = 'Y', trackStatus = #{trackStatus} where recordId = #{recordId}
        ]]>
	</update>

    <update id="batchUpdate" parameterType="list">
		<![CDATA[

        ]]>
	</update>

    <select id="queryAll" resultMap="maintainRecordResultMap">
		<![CDATA[

        ]]>
	</select>

    <select id="queryByStatus" resultMap="maintainRecordResultMap" parameterType="string">
		<![CDATA[

        ]]>
	</select>

    <select id="query" parameterType="maintainRecord" resultType="maintainRecord">
		<![CDATA[

        ]]>
	</select>

    <select id="queryById" parameterType="string" resultType="maintainRecord">
		<![CDATA[

        ]]>
	</select>

    <select id="queryByPager" resultType="list" resultMap="maintainRecordResultMap"
            parameterType="com.gs.common.bean.Pager">
		<![CDATA[

		  select r.*, c.checkinId, c.userName, c.carPlate, c.maintainOrFix, cpy.companyId, cpy.companyName from t_maintain_record r,  t_checkin c, t_company cpy where c.checkinId = r.checkinId and c.companyId = cpy.companyId

        ]]>
        order by r.recordCreatedTime desc, r.companyId
        limit #{beginIndex}, #{pageSize}
	</select>

    <select id="count" resultType="int">
		<![CDATA[

		  select count(*) from t_maintain_record

        ]]>
	</select>

    <update id="inactive" parameterType="string">
		<![CDATA[

		  update t_maintain_record set recordStatus = 'N' where recordId = #{id}

        ]]>
	</update>

    <update id="active" parameterType="string">
		<![CDATA[

		  update t_maintain_record set recordStatus = 'Y' where recordId = #{id}

        ]]>
	</update>

</mapper>
